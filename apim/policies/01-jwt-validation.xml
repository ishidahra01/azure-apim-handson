<policies>
  <inbound>
    <base />

    <!-- Entra ID の JWT を検証 -->
    <validate-jwt
        header-name="Authorization"
        require-scheme="Bearer"
        failed-validation-httpcode="401"
        failed-validation-error-message="Unauthorized: Invalid or missing token">

      <!-- Entra の OpenID 構成（テナントIDを差し替え）-->
      <openid-config url="https://login.microsoftonline.com/{{entra-tenant-id}}/v2.0/.well-known/openid-configuration" />

      <!-- 対象の API App ID URI（アプリ登録で設定したもの）-->
      <audiences>
        <audience>api://{{orders-api-app-id}}</audience>
      </audiences>

      <!-- 許可スコープ（任意）-->
      <required-claims>
        <claim name="scp" match="any">
          <value>Orders.Read</value>
          <value>Orders.ReadWrite</value>
        </claim>
      </required-claims>
    </validate-jwt>

  </inbound>

  <backend><base /></backend>
  <outbound><base /></outbound>
  <on-error><base /></on-error>
</policies>